<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Foosball Game</title>
    <script src="SAT.js"></script>
    <style>
    canvas { 
        background: #27BC3F;
     }
    #score {
        margin-left: 320px;
        margin-top: -484px;
        width: 120px;
        font-family: verdana;
        padding: 5px 5px 5px 5px;
    }
    #blue {
        color: #0095DD;
    }
    #red {
        color: #E03333;
    }
    </style>
</head>
<body>
<canvas id="myCanvas" width="320" height="480"></canvas>
<div id="score">
<h3 id = "blue">Blue : <span id="home">0</span></h3>
<h3 id = "red">Red : <span id="away">0</span></h3>
</div>
</body>
    <script>
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
var x = 10;
var y = 10;
var ballRadius = 6;
var dx = 1;
var dy = -1;
var m = 0;
var j = 0;
var paddleHeight = 10;
var paddleWidth = 15;
var paddleX = (canvas.width-paddleWidth);
var rightPressed = false;
var leftPressed = false;    
var goalpostWidth = 75;
var goalpostHeight = 10;
var homeScore = 0;
var awayScore = 0;
var rightPressedAway = false;
var leftPressedAway = false;
//console.log(canvas.height);
document.addEventListener("keydown", keyDownHandler, false);
document.addEventListener("keyup", keyUpHandler, false);

var V = SAT.Vector;
var C = SAT.Circle;
var P = SAT.Polygon;

var circle;
// A square


function drawBall() {
     ctx.beginPath();
     ctx.arc(x, y, ballRadius, 0, Math.PI*2);
     ctx.fillStyle = "white";
     ctx.fill();
     ctx.closePath();
circle = new C(new V(x,y), ballRadius);
    // ctx.beginPath();
    // //var gphX = paddleX/2;
    // //var gphY = canvas.height - goalpostHeight;
    // ctx.rect(x, y, ballRadius, ballRadius);
    // ctx.fillStyle = "#030303";
    // ctx.fill();
    // ctx.closePath();
    ctx.beginPath();
    //var gphX = paddleX/2;
    //var gphY = canvas.height - goalpostHeight;
    ctx.rect(0, 200, canvas.width, canvas.height-200);
    ctx.strokeStyle = "rgba(0, 0, 255, 0.5)";
ctx.stroke();
    ctx.closePath();
            var polygon = new P(new V(0,200), [
  new V(0,200), new V(320,200), new V(320,480), new V(0,480)
]);
  //  ctx.rect(152.5, 410, 167.5 - 152.5, 420-410);
//console.log('1: (', gkX,  ',' , gkY, ') 2: (', gkX+paddleWidth, ',' , gkY, ') 3: (', gkX+paddleWidth,  ',' , gkY+paddleHeight, ') 4: (', gkX,  ',' ,gkY+paddleHeight, ')');
//console.log(circle, polygon);
var response = new SAT.Response();
var collided = SAT.testPolygonCircle(polygon, circle, response);
if(collided)
console.log(circle.pos.x, circle.pos.y, polygon.pos.x, polygon.pos.y);
//console.log('collided', collided);

    //1: ( 152.5 , 410 ) 2: ( 167.5 , 410 ) 3: ( 167.5 , 420 ) 4: ( 152.5 , 420 )
   
    if(x + dx > canvas.width-ballRadius || x + dx < ballRadius) {
    dx = -dx;
    }
    if(y + dy > canvas.height-ballRadius || y + dy < ballRadius) {
        dy = -dy;
    }

}


function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBall();
 //   drawPlayers();
  //  drawGoalPost();
  //  console.log('Home: ', homeScore, 'Away: ', awayScore);
    x += dx;
    y += dy;
    if(rightPressed && paddleX*3/4 + m < canvas.width-paddleWidth) {
        m += 2;  
    }
    else if(leftPressed && paddleX/4 + m > 0) {
        m -= 2;
    }
    // else if(x > canvas.width/2 && paddleX*7/8 + j < canvas.width-paddleWidth) {
    //     j += 15;
    // }
    // else if(x < canvas.width/2 && paddleX*1/8 + j > 0) {
    //     j -= 15;
    // }
}

function updateScore(goal) {

    if(goal === 'home') {
        awayScore += 1;
        document.getElementById('away').innerHTML = awayScore;
    }
    else {
        homeScore += 1;
        document.getElementById('home').innerHTML = homeScore;
    }
}

function resetBall() {
    x = canvas.height/2;
    y = canvas.width/2;
}

function drawGoalPost() {

    //home
    ctx.beginPath();
    var gphX = paddleX/2;
    var gphY = canvas.height - goalpostHeight;
    ctx.rect(gphX, gphY, goalpostWidth, goalpostHeight);
    ctx.fillStyle = "#9C9C9C";
    ctx.fill();
    ctx.closePath();
   // if(y == canvas.height)
       
    if(y >= gphY && (x > gphX && x < gphX + goalpostWidth)) {
        console.log('home scored');
        updateScore('home');
        resetBall();
    }
    //console.log('called');
    //away
    ctx.beginPath();
    var gpaX = paddleX/2;
    var gpaY = paddleHeight;
    ctx.rect(gpaX, gpaY, goalpostWidth, goalpostHeight);
    ctx.fillStyle = "#9C9C9C";
    ctx.fill();
    ctx.closePath();
    // alert(y + ','+ gpaY);
    if(y <= gpaY && (x > gpaX && x < gpaX + goalpostWidth)) {
        console.log('away scored'); 
        updateScore('away');
        resetBall();
    }
}

function drawGoalkeeper() {

    ctx.beginPath();
    var gkX = paddleX/2 + m;
    var gkY = canvas.height*7/8-paddleHeight;
    ctx.rect(gkX, gkY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= gkY && y < gkY + paddleHeight) && (x > gkX  && x < gkX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }
//     var polygon = new P(new V(gkX,gkY), [
//   new V(gkX,gkY), new V(gkX+paddleWidth,gkY), new V(gkX+paddleWidth,gkY+paddleHeight), new V(gkX,gkY+paddleHeight)
// ]);

        var polygon = new P(new V(152.5,410), [
  new V(152.5,410), new V(167.5,410), new V(167.5,420), new V(152.5,420)
]);
  //  ctx.rect(152.5, 410, 167.5 - 152.5, 420-410);
//console.log('1: (', gkX,  ',' , gkY, ') 2: (', gkX+paddleWidth, ',' , gkY, ') 3: (', gkX+paddleWidth,  ',' , gkY+paddleHeight, ') 4: (', gkX,  ',' ,gkY+paddleHeight, ')');
//console.log(circle, polygon);
var response = new SAT.Response();
var collided = SAT.testPolygonCircle(polygon, circle, response);
console.log('collided', collided);

}


function drawDefenders() {

    ctx.beginPath();
    var lcbX = paddleX/4 + m;
    var lcbY = canvas.height*13/16-paddleHeight;
    ctx.rect(lcbX, lcbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= lcbY && y < lcbY + paddleHeight) && (x > lcbX  && x < lcbX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rcbX = paddleX*3/4 + m;
    var rcbY = canvas.height*13/16-paddleHeight;
    ctx.rect(rcbX, rcbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= rcbY && y < rcbY + paddleHeight) && (x > rcbX  && x < rcbX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }
}

function drawMidfielders() {

    //midfielders
    ctx.beginPath();
    var lwbX = paddleX*1/8 + m;
    var lwbY = canvas.height*5/8-paddleHeight;
    ctx.rect(lwbX, lwbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= lwbY  && y  < lwbY + paddleHeight) && (x > lwbX   && x < lwbX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }


    ctx.beginPath();
    var lcmX = paddleX*3/8 + m;
    var lcmY = canvas.height*5/8-paddleHeight;
    ctx.rect(lcmX, lcmY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y  >= lcmY && y  < lcmY + paddleHeight) && (x > lcmX  && x < lcmX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rcmX = paddleX*5/8 + m;
    var rcmY = canvas.height*5/8-paddleHeight;
    ctx.rect(rcmX, rcmY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y  >= lcmY && y  < lcmY + paddleHeight) && (x > rcmX  && x < rcmX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rwbX = paddleX*7/8 + m;
    var rwbY = canvas.height*5/8-paddleHeight;
    ctx.rect(rwbX, rwbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y  >= lcmY && y< lcmY + paddleHeight) && (x > rwbX  && x < rwbX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }
  
}

function drawStrikers() {
        //attackers
    ctx.beginPath();
    var lwX = paddleX/4 + m;
    var lwY = canvas.height*9/32-paddleHeight;
    ctx.rect(lwX, lwY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= lwY && y < lwY + paddleHeight) && (x > lwX  && x < lwX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var cfX = paddleX/2 + m;
    var cfY = canvas.height*9/32-paddleHeight;
    ctx.rect(cfX, cfY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= cfY && y < cfY + paddleHeight) && (x > cfX  && x < cfX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rwX = paddleX*3/4 + m;
    var rwY = canvas.height*9/32-paddleHeight;
    ctx.rect(rwX, rwY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#0095DD";
    ctx.fill();
    ctx.closePath();
    if((y >= rwY && y < rwY + paddleHeight) && (x > rwX  && x < rwX + paddleWidth ) ) {
        if(dy < 0)
            dx = -dx;
        else
            dy = -dy;
    }
}
function drawPlayers() {

    //home
    drawGoalkeeper();
    drawDefenders();
    drawMidfielders();
    drawStrikers();

    //away
     drawAwayGoalkeeper();
     drawAwayDefenders();
     drawAwayMidfielders();
     drawAwayStrikers();
}

function drawAwayGoalkeeper() {

    ctx.beginPath();
    var gkX = paddleX/2 + j;
    var gkY = canvas.height*1/8-paddleHeight;
    ctx.rect(gkX, gkY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= gkY && y < gkY + paddleHeight) && (x > gkX  && x < gkX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }
    if(y + 10 == gkY || y - 10 == gkY) {
        if(x > gkX)
            j +=10;
        else
            j -=10;
    }
}

function drawAwayDefenders() {

    ctx.beginPath();
    var lcbX = paddleX/4 + j;
    var lcbY = canvas.height*3/16-paddleHeight;
    ctx.rect(lcbX, lcbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= lcbY && y < lcbY + paddleHeight) && (x > lcbX  && x < lcbX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }


    ctx.beginPath();
    var rcbX = paddleX*3/4 + j;
    var rcbY = canvas.height*3/16-paddleHeight;
    ctx.rect(rcbX, rcbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= rcbY && y < rcbY + paddleHeight) && (x > rcbX  && x < rcbX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }
    if(y + 10 == rcbY || y - 10 == rcbY) {
        if(x > lcbX)
            j +=10;
        else
            j -=10;
        if(x > rcbX)
            j +=10;
        else
            j -=10;
    }
}

function drawAwayMidfielders() {

    //midfielders
    ctx.beginPath();
    var lwbX = paddleX*1/8 + j;
    var lwbY = canvas.height*3/8-paddleHeight;
    ctx.rect(lwbX, lwbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= lwbY && y < lwbY + paddleHeight) && (x > lwbX   && x < lwbX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }


    ctx.beginPath();
    var lcmX = paddleX*3/8 + j;
    var lcmY = canvas.height*3/8-paddleHeight;
    ctx.rect(lcmX, lcmY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= lcmY && y < lcmY + paddleHeight) && (x > lcmX  && x < lcmX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rcmX = paddleX*5/8 + j;
    var rcmY = canvas.height*3/8-paddleHeight;
    ctx.rect(rcmX, rcmY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= lcmY && y < lcmY + paddleHeight) && (x > rcmX  && x < rcmX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rwbX = paddleX*7/8 + j;
    var rwbY = canvas.height*3/8-paddleHeight;
    ctx.rect(rwbX, rwbY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= lcmY && y < lcmY + paddleHeight) && (x > rwbX  && x < rwbX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }
    if(y + 10 == rwbY || y - 10 == rwbY) {
        if(x > lwbX)
            j +=10;
        else
            j -=10;
        if(x > rwbX)
            j +=10;
        else
            j -=10;
        if(x > rcmX)
            j +=10;
        else
            j -=10;
        if(x > lcmX)
            j +=10;
        else
            j -=10;
    }
  
}

function drawAwayStrikers() {
        //attackers
    ctx.beginPath();
    var lwX = paddleX/4 + j;
    var lwY = canvas.height*23/32-paddleHeight;
    ctx.rect(lwX, lwY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= lwY && y < lwY + paddleHeight) && (x > lwX  && x < lwX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var cfX = paddleX/2 + j;
    var cfY = canvas.height*23/32-paddleHeight;
    ctx.rect(cfX, cfY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= cfY && y < cfY + paddleHeight) && (x > cfX  && x < cfX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;
    }

    ctx.beginPath();
    var rwX = paddleX*3/4 + j;
    var rwY = canvas.height*23/32-paddleHeight;
    ctx.rect(rwX, rwY, paddleWidth, paddleHeight);
    ctx.fillStyle = "#E03333";
    ctx.fill();
    ctx.closePath();
    if((y >= rwY && y < rwY + paddleHeight) && (x > rwX && x < rwX + paddleWidth ) ) {
        if(dy > 0)
            dx = -dx;
        else
            dy = -dy;

    if(y + 10 == rwY || y - 10 == rwY) {
        if(x > lwX)
            j +=10;
        else
            j -=10;
        if(x > rwX)
            j +=10;
        else
            j -=10;
        if(x > cfX)
            j +=10;
        else
            j -=10;
    }

    }
}

function keyDownHandler(e) {
    if(e.keyCode == 39) {
        rightPressed = true;
    }
    else if(e.keyCode == 37) {
        leftPressed = true;
    }
    else if(e.keyCode == 65) {
        leftPressedAway = true; 
    }
    else if(e.keyCode == 68) {
        rightPressedAway = true;
    }
}

function keyUpHandler(e) {
    if(e.keyCode == 39) {
        rightPressed = false;
    }
    else if(e.keyCode == 37) {
        leftPressed = false;
    }
    else if(e.keyCode == 65) {
        leftPressedAway = false; 
    }
    else if(e.keyCode == 68) {
        rightPressedAway = false;
    }
}
setInterval(draw, 10);
    </script>
</html>